<!doctype html>
<html
  xmlns:th="https://www.thymeleaf.org"
  th:replace="~{modules/layout :: layout(title = ${post.spec.title} + ' - ' + ${site.title}, content = ~{::content}, head = ~{::head}, bodyClass = 'page-announcement')}"
>
  <th:block th:fragment="head">
    <link rel="stylesheet" th:href="${#theme.assets('/build/page-post.css')}" />
    <script type="module" th:src="${#theme.assets('/build/page-post.js')}"></script>
  </th:block>
  <th:block th:fragment="content">
    <article
      class="content-block announcement-page"
      th:with="annotations=${post.metadata != null ? post.metadata.annotations : null},
               articleIdPluginAvailable=${pluginFinder.available('article-id-management')},
               articleIdFullCode=${annotations != null ? annotations['article-id-management/fullCode'] : null},
               articleIdStatusRaw=${annotations != null ? annotations['article-id-management/status'] : null},
               articleIdStatus=${#strings.equals(articleIdStatusRaw, 'REGISTERED') ? '已注册'
                  : (#strings.equals(articleIdStatusRaw, 'BOUND') ? '已绑定'
                  : (#strings.equals(articleIdStatusRaw, 'SUPERSEDED') ? '已替代'
                  : (#strings.equals(articleIdStatusRaw, 'VOID') ? '已作废'
                  : (#strings.equals(articleIdStatusRaw, 'DELETED') ? '已删除' : articleIdStatusRaw))))},
               articleIdEffectiveDate=${annotations != null ? annotations['article-id-management/effectiveDate'] : null},
               articleIdVoidDate=${annotations != null ? annotations['article-id-management/voidDate'] : null},
               articleIdIssuingAgencyRaw=${annotations != null ? annotations['article-id-management/issuingAuthority'] : null},
               articleIdIssuingAgencyAlt=${annotations != null ? annotations['article-id-management/issuingAgency'] : null},
               articleIdIssuingAgency=${!#strings.isEmpty(articleIdIssuingAgencyRaw) ? articleIdIssuingAgencyRaw
                  : articleIdIssuingAgencyAlt},
               contactPerson=${post.owner != null ? post.owner.displayName : ''},
               categories=${post.categories},
               tags=${post.tags},
               firstCategory=${categories != null and #lists.size(categories) > 0 ? categories.get(0) : null},
               breadcrumbs=${firstCategory != null && firstCategory.metadata != null ? categoryFinder.getBreadcrumbs(firstCategory.metadata.name) : null},
               contentVo=${postFinder.content(post.metadata.name)},
               contentVoContent=${contentVo != null ? contentVo.content : null},
               contentVoRaw=${contentVo != null ? contentVo.raw : null},
               contentVoContentLen=${contentVoContent != null ? #strings.length(contentVoContent) : 0},
               contentVoRawLen=${contentVoRaw != null ? #strings.length(contentVoRaw) : 0},
               preferContentVoRaw=${contentVoRawLen > 0 and (contentVoContentLen == 0 or contentVoContentLen * 2 < contentVoRawLen)},
               postContent=${preferContentVoRaw ? contentVoRaw
                  : (contentVoContentLen > 0 ? contentVoContent
                  : (post.content != null and !#strings.isEmpty(post.content.content) ? post.content.content
                  : (post.content != null and !#strings.isEmpty(post.content.raw) ? post.content.raw : '')))}"
    >
      <header class="post-header announcement-header">
        <h1 class="post-title announcement-title" th:text="${post.spec.title}"></h1>
        <div class="announcement-meta" th:if="${articleIdPluginAvailable}">
          <table class="announcement-meta-table" role="presentation">
            <tbody>
              <tr>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">主</span>
                      <span class="announcement-meta-label-char">题</span>
                      <span class="announcement-meta-label-char">分</span>
                      <span class="announcement-meta-label-char">类</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value announcement-meta-links" th:if="${firstCategory != null}">
                      <th:block th:if="${breadcrumbs != null and #lists.size(breadcrumbs) > 0}">
                        <th:block th:each="crumb, stat : ${breadcrumbs}">
                          <a
                            class="announcement-meta-link"
                            th:href="@{${crumb.status.permalink}}"
                            th:text="${crumb.spec.displayName}"
                          ></a>
                          <span class="announcement-meta-sep" th:if="${!stat.last}">></span>
                        </th:block>
                      </th:block>
                      <a
                        class="announcement-meta-link"
                        th:if="${breadcrumbs == null or #lists.size(breadcrumbs) == 0}"
                        th:href="@{${firstCategory.status.permalink}}"
                        th:text="${firstCategory.spec.displayName}"
                      ></a>
                    </span>
                  </div>
                </td>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">文</span>
                      <span class="announcement-meta-label-char">件</span>
                      <span class="announcement-meta-label-char">编</span>
                      <span class="announcement-meta-label-char">号</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${#strings.isEmpty(articleIdFullCode) ? '' : articleIdFullCode}"></span>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">发</span>
                      <span class="announcement-meta-label-char">布</span>
                      <span class="announcement-meta-label-char">日</span>
                      <span class="announcement-meta-label-char">期</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${post.spec.publishTime != null ? #temporals.format(post.spec.publishTime, 'yyyy-MM-dd') : ''}"></span>
                  </div>
                </td>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">有</span>
                      <span class="announcement-meta-label-char">效</span>
                      <span class="announcement-meta-label-char">性</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${#strings.isEmpty(articleIdStatus) ? '' : articleIdStatus}"></span>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">实</span>
                      <span class="announcement-meta-label-char">施</span>
                      <span class="announcement-meta-label-char">日</span>
                      <span class="announcement-meta-label-char">期</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${#strings.isEmpty(articleIdEffectiveDate) ? '' : articleIdEffectiveDate}"></span>
                  </div>
                </td>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">废</span>
                      <span class="announcement-meta-label-char">止</span>
                      <span class="announcement-meta-label-char">日</span>
                      <span class="announcement-meta-label-char">期</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${#strings.isEmpty(articleIdVoidDate) ? '' : articleIdVoidDate}"></span>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">发</span>
                      <span class="announcement-meta-label-char">文</span>
                      <span class="announcement-meta-label-char">机</span>
                      <span class="announcement-meta-label-char">构</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${#strings.isEmpty(articleIdIssuingAgency) ? '' : articleIdIssuingAgency}"></span>
                  </div>
                </td>
                <td class="announcement-meta-cell">
                  <div class="announcement-meta-item">
                    <span class="announcement-meta-bracket announcement-meta-bracket-left">[</span>
                    <span class="announcement-meta-label">
                      <span class="announcement-meta-label-char">接</span>
                      <span class="announcement-meta-label-char">口</span>
                      <span class="announcement-meta-label-char">人</span>
                    </span>
                    <span class="announcement-meta-bracket announcement-meta-bracket-right">]</span>
                    <span class="announcement-meta-value" th:text="${#strings.isEmpty(contactPerson) ? '' : contactPerson}"></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </header>
      <div class="content-body post-body" th:utext="${postContent}"></div>
      <div class="announcement-signature">
        <div class="announcement-signature-name">机魂融创联盟</div>
        <div
          class="announcement-signature-date"
          th:text="${post.spec.publishTime != null ? #temporals.format(post.spec.publishTime, 'yyyy年MM月dd日') : ''}"
        ></div>
      </div>
    </article>
  </th:block>
</html>
