<!doctype html>
<html
  xmlns:th="https://www.thymeleaf.org"
  th:replace="~{modules/layout :: layout(title = ${post.spec.title} + ' - ' + ${site.title}, content = ~{::content}, head = ~{::head}, bodyClass = 'page-announcement')}"
>
  <th:block th:fragment="head">
    <link rel="stylesheet" th:href="${#theme.assets('/build/page-post.css')}" />
    <script type="module" th:src="${#theme.assets('/build/page-post.js')}"></script>
  </th:block>
  <th:block th:fragment="content">
    <article
      class="content-block announcement-page"
      th:with="annotations=${post.metadata != null ? post.metadata.annotations : null},
               fileNumber=${annotations != null ? annotations['fileNumber'] : null},
               categories=${post.categories},
               tags=${post.tags},
               firstCategory=${categories != null and #lists.size(categories) > 0 ? categories.get(0) : null},
               breadcrumbs=${firstCategory != null && firstCategory.metadata != null ? categoryFinder.getBreadcrumbs(firstCategory.metadata.name) : null},
               contentVo=${postFinder.content(post.metadata.name)},
               contentVoContent=${contentVo != null ? contentVo.content : null},
               contentVoRaw=${contentVo != null ? contentVo.raw : null},
               contentVoContentLen=${contentVoContent != null ? #strings.length(contentVoContent) : 0},
               contentVoRawLen=${contentVoRaw != null ? #strings.length(contentVoRaw) : 0},
               preferContentVoRaw=${contentVoRawLen > 0 and (contentVoContentLen == 0 or contentVoContentLen * 2 < contentVoRawLen)},
               postContent=${preferContentVoRaw ? contentVoRaw
                  : (contentVoContentLen > 0 ? contentVoContent
                  : (post.content != null and !#strings.isEmpty(post.content.content) ? post.content.content
                  : (post.content != null and !#strings.isEmpty(post.content.raw) ? post.content.raw : '')))}"
    >
      <header class="post-header announcement-header">
        <h1 class="post-title announcement-title" th:text="${post.spec.title}"></h1>
        <div class="announcement-meta">
          <div class="announcement-meta-grid">
            <div class="announcement-meta-item" th:if="${post.owner != null}">
              <span class="announcement-meta-label">[发文机关]</span>
              <span class="announcement-meta-value" th:text="${post.owner.displayName}"></span>
            </div>
            <div class="announcement-meta-item">
              <span class="announcement-meta-label">[文件编号]</span>
              <span class="announcement-meta-value" th:text="${#strings.isEmpty(fileNumber) ? '' : fileNumber}"></span>
            </div>
            <div class="announcement-meta-item" th:if="${post.spec.publishTime != null}">
              <span class="announcement-meta-label">[发布日期]</span>
              <span class="announcement-meta-value" th:text="${#temporals.format(post.spec.publishTime, 'yyyy-MM-dd')}"></span>
            </div>
            <div class="announcement-meta-item" th:if="${firstCategory != null}">
              <span class="announcement-meta-label">[主题分类]</span>
              <span class="announcement-meta-value announcement-meta-links">
                <th:block th:if="${breadcrumbs != null and #lists.size(breadcrumbs) > 0}">
                  <th:block th:each="crumb, stat : ${breadcrumbs}">
                    <a
                      class="announcement-meta-link"
                      th:href="@{${crumb.status.permalink}}"
                      th:text="${crumb.spec.displayName}"
                    ></a>
                    <span class="announcement-meta-sep" th:if="${!stat.last}">></span>
                  </th:block>
                </th:block>
                <a
                  class="announcement-meta-link"
                  th:if="${breadcrumbs == null or #lists.size(breadcrumbs) == 0}"
                  th:href="@{${firstCategory.status.permalink}}"
                  th:text="${firstCategory.spec.displayName}"
                ></a>
              </span>
            </div>
          </div>
        </div>
      </header>
      <div class="content-body post-body" th:utext="${postContent}"></div>
      <div class="announcement-signature">
        <div class="announcement-signature-name">机魂融创联盟</div>
        <div
          class="announcement-signature-date"
          th:text="${post.spec.publishTime != null ? #temporals.format(post.spec.publishTime, 'yyyy年MM月dd日') : ''}"
        ></div>
      </div>
    </article>
  </th:block>
</html>
