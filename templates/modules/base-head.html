<th:block th:fragment="base-head(title)">
  <th:block
    th:with="postExcerpt=${post != null && post.status != null ? post.status.excerpt : ''},
             postContentVo=${post != null && #strings.isEmpty(postExcerpt) ? postFinder.content(post.metadata.name) : null},
             postContent=${postContentVo != null
               ? (postContentVo.content != null && !#strings.isEmpty(postContentVo.content)
                 ? postContentVo.content
                 : (postContentVo.raw != null ? postContentVo.raw : ''))
               : ''},
             singleExcerpt=${singlePage != null && singlePage.status != null ? singlePage.status.excerpt : ''},
             singleContent=${singlePage != null && #strings.isEmpty(singleExcerpt)
               ? (singlePage.content != null
                 ? (singlePage.content.content != null ? singlePage.content.content : singlePage.content.raw)
                 : '')
               : ''},
             categoryDesc=${category != null && category.spec != null ? category.spec.description : ''},
             tagDesc=${tag != null && tag.spec != null ? tag.spec.description : ''},
             docDesc=${docTree != null && docTree.spec != null ? docTree.spec.description : ''},
             rawDescription=${!#strings.isEmpty(postExcerpt)
               ? postExcerpt
               : (!#strings.isEmpty(singleExcerpt)
                 ? singleExcerpt
                 : (!#strings.isEmpty(categoryDesc)
                   ? categoryDesc
                   : (!#strings.isEmpty(tagDesc)
                     ? tagDesc
                     : (!#strings.isEmpty(docDesc)
                       ? docDesc
                       : (!#strings.isEmpty(singleContent) ? singleContent : postContent)))))},
             metaDescription=${#strings.isEmpty(rawDescription)
               ? site.title
               : (#strings.length(rawDescription) > 200
                 ? #strings.substring(rawDescription, 0, 200) + '...'
                 : rawDescription)}"
  >
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${title}"></title>
    <meta name="description" th:if="${not #strings.isEmpty(metaDescription)}" th:content="${metaDescription}" />
    <meta property="og:title" th:content="${title}" />
    <meta property="og:site_name" th:content="${site.title}" />
    <meta
      property="og:description"
      th:if="${not #strings.isEmpty(metaDescription)}"
      th:content="${metaDescription}"
    />
    <meta property="og:image" th:if="${not #strings.isEmpty(site.logo)}" th:content="${site.logo}" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" th:content="${title}" />
    <meta
      name="twitter:description"
      th:if="${not #strings.isEmpty(metaDescription)}"
      th:content="${metaDescription}"
    />
    <meta name="twitter:image" th:if="${not #strings.isEmpty(site.logo)}" th:content="${site.logo}" />
    <script>
      (function () {
        var root = document.documentElement;
        var scheme = root.dataset.scheme || "system";
        var allow = root.dataset.allowScheme === "true";
        var key = "theme-organization-color-scheme";
        var stored = allow ? localStorage.getItem(key) : null;
        var value = stored || scheme;
        var resolved = value;
        if (!resolved || resolved === "system") {
          var prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;
          resolved = prefersDark ? "dark" : "light";
        }
        root.setAttribute("data-theme", resolved);
        root.style.colorScheme = resolved;
      })();
    </script>
    <link rel="stylesheet" th:href="${#theme.assets('/build/main.css')}" />
    <script type="module" th:src="${#theme.assets('/build/main.js')}"></script>
  </th:block>
</th:block>
